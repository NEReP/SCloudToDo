const tasksList=document.getElementById("tasksList"),taskInput=document.querySelector(".add-task__input"),taskPopup=document.getElementById("taskPopup"),popupClose=document.getElementById("popupClose"),popupTaskText=document.getElementById("popupTaskText"),applyChangesButton=document.getElementById("applyChanges"),addTaskButton=document.getElementById("addTaskButton"),deleteTaskButton=document.getElementById("deleteTaskButton"),statusWrapper=document.querySelector(".popup__wrapper"),taksOpenBoard=document.getElementById("open"),taksWorkBoard=document.getElementById("at-work"),taksClosedBoard=document.getElementById("closed"),alertText=document.querySelector(".alert"),clearInputButton=document.querySelector(".del"),body=document.querySelector("body"),showMoreBtn=document.querySelector(".showMore__btn");let savedStatus,dragLists=document.getElementsByClassName("task-board__list"),statuses=[],tasks=[];function generateRandomID(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";for(let a=0;a<t;a++){const t=Math.floor(62*Math.random());s+=e.charAt(t)}return s}function renderTasks(){tasksList.innerHTML="",taksOpenBoard.innerHTML="",taksWorkBoard.innerHTML="",taksClosedBoard.innerHTML="",localStorage.getItem("Task")&&(tasks=JSON.parse(localStorage.getItem("Task"))),tasks.forEach((t=>{const e=createTaskElement(t);tasksList.appendChild(e),createTaskElementForTaskBoard(t)})),statuses=taskPopup.querySelectorAll(".tasks__status"),tasks.length>5?showMoreBtn.style.display="block":showMoreBtn.style.display="none"}function toggleClearButton(){taskInput.value.trim()?clearInputButton.style.display="block":clearInputButton.style.display="none"}function createTaskElementForTaskBoard(t){const e=document.createElement("li");switch(e.classList.add("task-board__item"),e.id=t.id,e.draggable="true",e.addEventListener("dragstart",(function(t){})),e.draggable="true",e.ondragstart="drag(event)",e.textContent=t.text,t.status){case"Открыт":taksOpenBoard.appendChild(e);break;case"В работе":taksWorkBoard.appendChild(e);break;case"Закрыт":taksClosedBoard.appendChild(e)}}function createTaskElement(t){const e=document.createElement("li");e.classList.add("tasks__item"),e.id=t.id,e.textContent=t.text;const s=document.createElement("button");return s.classList.add("tasks__status"),s.textContent=t.status,e.appendChild(s),e}function showPopup(t){popupTaskText.value=t.text;updateStatusButtons(getAvailableStatuses(t.status)),taskPopup.currentTask=t,taskPopup.style.display="block",popupBc.style.display="block",body.style.overflow="hidden"}addTaskButton.addEventListener("click",(function(){if(taskInput.value){const t={id:generateRandomID(10),text:taskInput.value,status:"Открыт"};tasks.push(t),setToLocalStorage(),renderTasks(),updateCounters(),taskInput.value="",clearInputButton.style.display="none"}})),taskInput.addEventListener("input",toggleClearButton),clearInputButton.addEventListener("click",(()=>{clearInputButton.style.display="none",taskInput.value=""})),tasksList.addEventListener("click",(function(t){if(t.target.className.includes("tasks__status")){const e=t.target.parentNode.id;showPopup(tasks.find((t=>t.id===e)))}})),popupClose.addEventListener("click",hidePopup),applyChangesButton.addEventListener("click",(function(){const t=taskPopup.currentTask.id,e=popupTaskText.value,s=tasks.find((e=>e.id===t));s&&(s.text=e,s.status=savedStatus||s.status),sortTasks(),setToLocalStorage(),hidePopup()})),deleteTaskButton.addEventListener("click",(function(){if(taskPopup.currentTask){const t=taskPopup.currentTask.id,e=tasks.findIndex((e=>e.id===t));-1!==e&&(tasks.splice(e,1),setToLocalStorage(),hidePopup(),renderTasks(),updateCounters())}}));const popupBc=document.querySelector(".popup-bc");function hidePopup(){taskPopup.style.display="none",popupBc.style.display="none",body.style.overflow="auto"}function getAvailableStatuses(){return setToLocalStorage(),{"В работу":"В работе","Отложить":"Открыт","Закрыть":"Закрыт"}}function updateStatusButtons(t){taskPopup.querySelectorAll(".popup__tasks-status").forEach((t=>t.remove())),Object.keys(t).forEach((e=>{const s=t[e],a=document.createElement("button");a.classList.add("popup__tasks-status"),a.textContent=e,a.addEventListener("click",(function(){savedStatus=s,sortTasks(),setToLocalStorage()})),statusWrapper.appendChild(a)}))}function sortTasks(){tasks.sort(((t,e)=>{const s=["Открыт","В работе","Закрыт"];return s.indexOf(t.status)-s.indexOf(e.status)})),renderTasks()}function updateCounters(){const t=document.querySelector(".openCounter"),e=document.querySelector(".inProgressCounter"),s=document.querySelector(".closedCounter"),a={"Открыт":0,"В работе":0,"Закрыт":0};tasks.forEach((t=>{a[t.status]++})),t.textContent=a["Открыт"],e.textContent=a["В работе"],s.textContent=a["Закрыт"]}function setToLocalStorage(){localStorage.setItem("Task",JSON.stringify(tasks))}function sortTasks(){tasks.sort(((t,e)=>{const s=["Открыт","В работе","Закрыт"];return s.indexOf(t.status)-s.indexOf(e.status)})),setToLocalStorage(),renderTasks(),updateCounters()}for(list of(popupBc.addEventListener("click",(()=>{hidePopup()})),dragLists))list.addEventListener("dragstart",(t=>{let e=t.target;taksOpenBoard.addEventListener("dragover",(t=>{t.preventDefault()})),taksWorkBoard.addEventListener("dragover",(t=>{t.preventDefault()})),taksClosedBoard.addEventListener("dragover",(t=>{t.preventDefault()})),taksOpenBoard.addEventListener("drop",(()=>{null!==e&&(taksOpenBoard.appendChild(e),findTaskItems(taksOpenBoard,e.id,taksOpenBoard.dataset.status),setToLocalStorage(),renderTasks(),updateCounters(),sortTasks()),e=null})),taksWorkBoard.addEventListener("drop",(()=>{null!==e&&(taksWorkBoard.appendChild(e),findTaskItems(taksOpenBoard,e.id,taksWorkBoard.dataset.status),setToLocalStorage(),renderTasks(),updateCounters(),sortTasks()),e=null})),taksClosedBoard.addEventListener("drop",(()=>{null!==e&&(taksClosedBoard.appendChild(e),findTaskItems(taksClosedBoard,e.id,taksClosedBoard.dataset.status),setToLocalStorage(),renderTasks(),updateCounters(),sortTasks()),e=null}))}));function findTaskItems(t,e,s){tasks.find((t=>t.id==e)).status=s}renderTasks(),updateCounters();